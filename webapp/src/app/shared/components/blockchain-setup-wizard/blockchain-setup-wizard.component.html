<form [formGroup]="form">
<clr-wizard #wizard [(clrWizardOpen)]="isOpen" (clrWizardOnFinish)="onSubmit()" (clrWizardOnCancel)="resetFragment()">
  <clr-wizard-title>{{'blockchainSetupWizard.title' | translate}}</clr-wizard-title>

  <clr-wizard-button [type]="'cancel'">{{'common.cancel' | translate}}</clr-wizard-button>
  <clr-wizard-button [type]="'previous'">{{'common.back' | translate}}</clr-wizard-button>
  <clr-wizard-button [type]="'next'">{{'common.next' | translate}}</clr-wizard-button>
  <clr-wizard-button [type]="'finish'">{{'common.finish' | translate}}</clr-wizard-button>

  <clr-wizard-page #blockConsortiumPage
                   [clrWizardPageNextDisabled]="!form.controls.blockchain.valid || !form.controls.consortium.valid || !form.controls.faultTolerance.valid">
    <ng-template clrPageTitle>{{'blockchainSetupWizard.blockchainAndConsortium.pageTitle' | translate}}</ng-template>
    <ng-template clrPageNavTitle>{{'blockchainSetupWizard.blockchainAndConsortium.navTitle' | translate}}</ng-template>
    <p>{{'blockchainSetupWizard.blockchainAndConsortium.description' | translate}}</p>
    <div class="form-block">
      <div class="form-group" formGroupName="blockchain">
        <label>{{'blockchainSetupWizard.blockchainAndConsortium.blockchainType' | translate}}</label>
        <div class="select">
          <select formControlName="type">
            <option value="athena">{{'blockchainSetupWizard.blockchainAndConsortium.athena' | translate}}</option>
            <option value="hyperledger">{{'blockchainSetupWizard.blockchainAndConsortium.hyperledger' | translate}}</option>
          </select>
        </div>
      </div>
      <div class="form-group" formGroupName="faultTolerance">
        <label>{{'blockchainSetupWizard.blockchainAndConsortium.faultTolerance' | translate}}</label>
        <div class="select">
          <select formControlName="type">
            <option value="global">{{'blockchainSetupWizard.blockchainAndConsortium.global' | translate}}</option>
            <option value="local">{{'blockchainSetupWizard.blockchainAndConsortium.local' | translate}}</option>
          </select>
        </div>
      </div>
      <div class="form-group" formGroupName="consortium">
        <label>{{'blockchainSetupWizard.blockchainAndConsortium.consortiumName' | translate}}</label>
        <input type="text" formControlName="name" />
      </div>
    </div>
  </clr-wizard-page>

  <clr-wizard-page #orgsPage [clrWizardPageNextDisabled]="!form.controls.organizations.valid">
    <ng-template clrPageTitle>{{'blockchainSetupWizard.addOrgs.pageTitle' | translate}}</ng-template>
    <ng-template clrPageNavTitle>{{'blockchainSetupWizard.addOrgs.navTitle' | translate}}</ng-template>
    <p>{{'blockchainSetupWizard.addOrgs.description' | translate}}</p>
    <div [formGroup]="orgForm">
      <div class="form-group row">
        <div class="col-xs-4 col-sm-2">
          <label>{{'blockchainSetupWizard.addOrgs.name' | translate}}</label>
        </div>
        <div class="col-xs-8 col-sm-4">
          <input type="text" formControlName="name" class="form-control">
        </div>
        <div class="col-xs-4 col-sm-2">
          <label>{{'blockchainSetupWizard.addOrgs.location' | translate}}</label>
        </div>
        <div class="col-xs-8 col-sm-4">
          <div class="select">
            <select formControlName="location">
              <option *ngFor="let location of locationOptions" value="{{location.value}}">{{location.name | translate}}</option>
            </select>
          </div>
        </div>
      </div>
      <div class="text-right">
        <button type="button" class="btn btn-primary-outline btn-sm" (click)="addOrg()" [disabled]="!orgForm.valid">{{'blockchainSetupWizard.addOrgs.addOrganization' | translate}}</button>
      </div>
      <table class="table">
        <thead>
        <tr>
          <th class="left">{{'blockchainSetupWizard.addOrgs.name' | translate}}</th>
          <th class="left">{{'blockchainSetupWizard.addOrgs.location' | translate}}</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let org of form?.value.organizations; let i = index">
          <td class="left">
            {{org.name}}
          </td>
          <td class="left">
            {{'blockchainSetupWizard.locations.' + org.location | translate}}
            <div class="float-xs-right table-actions">
              <clr-icon shape="trash" (click)="deleteOrg(i)"></clr-icon>
              <clr-icon shape="pencil" (click)="onEditOrg(i)"></clr-icon>
            </div>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </clr-wizard-page>

  <clr-wizard-page #usersPage [clrWizardPageNextDisabled]="!form.controls.users.valid">
    <ng-template clrPageTitle>{{'blockchainSetupWizard.usersAndAccess.pageTitle' | translate}}</ng-template>
    <ng-template clrPageNavTitle>{{'blockchainSetupWizard.usersAndAccess.navTitle' | translate}}</ng-template>
    <p>{{'blockchainSetupWizard.usersAndAccess.description' | translate}}</p>
    <div [formGroup]="userForm">
      <div class="form-group row">
        <div class="col-xs-4 col-sm-2">
          <label>{{'blockchainSetupWizard.usersAndAccess.firstName' | translate}}</label>
        </div>
        <div class="col-xs-8 col-sm-4">
          <input type="text" formControlName="firstName" class="form-control">
        </div>
        <div class="col-xs-4 col-sm-2">
          <label>{{'blockchainSetupWizard.usersAndAccess.lastName' | translate}}</label>
        </div>
        <div class="col-xs-8 col-sm-4">
          <input type="text" formControlName="lastName" class="form-control">
        </div>
      </div>
      <div class="form-group row">
        <div class="col-xs-4 col-sm-2">
          <label>{{'blockchainSetupWizard.usersAndAccess.email' | translate}}</label>
        </div>
        <div class="col-xs-8 col-sm-4">
          <input type="text" formControlName="email" class="form-control">
        </div>
        <div class="col-xs-4 col-sm-2">
          <label>{{'blockchainSetupWizard.usersAndAccess.organization' | translate}}</label>
        </div>
        <div class="col-xs-8 col-sm-4">
          <div class="select">
            <select name="" formControlName="organization">
              <option *ngFor="let org of form?.value.organizations" value="{{org.name}}">{{org.name}}</option>
            </select>
          </div>
        </div>
      </div>
      <div class="form-group row">
        <div class="col-xs-4 col-sm-2">
          <label>{{'blockchainSetupWizard.usersAndAccess.role' | translate}}</label>
        </div>
        <div class="col-xs-8 col-sm-4">
          <div class="select">
            <select formControlName="role">
              <option *ngFor="let persona of personaOptions" value="{{persona.value}}">{{persona.name | translate}}</option>
            </select>
          </div>
        </div>
      </div>
      <div class="text-right">
        <button class="btn btn-sm btn-primary-outline" type="button" (click)="addUser()" [disabled]="!userForm.valid">{{'blockchainSetupWizard.usersAndAccess.addUser' | translate}}</button>
      </div>
    </div>
    <clr-datagrid>
      <clr-dg-column>{{'blockchainSetupWizard.usersAndAccess.firstName' | translate}}</clr-dg-column>
      <clr-dg-column>{{'blockchainSetupWizard.usersAndAccess.lastName' | translate}}</clr-dg-column>
      <clr-dg-column>{{'blockchainSetupWizard.usersAndAccess.role' | translate}}</clr-dg-column>
      <clr-dg-row *ngFor="let user of form?.value.users; let i = index">
        <clr-dg-cell>{{user.firstName}}</clr-dg-cell>
        <clr-dg-cell>{{user.lastName}}</clr-dg-cell>
        <clr-dg-cell>
          {{user.role}}
          <div class="float-xs-right table-actions">
            <clr-icon shape="trash" (click)="deleteUser(i)"></clr-icon>
            <clr-icon shape="pencil" (click)="onEditUser(i)"></clr-icon>
          </div>
        </clr-dg-cell>
        <clr-dg-row-detail *clrIfExpanded>
          <table class="table table-noborder mt-0">
            <thead>
            <tr>
              <th class="left border-bottom-0">{{'blockchainSetupWizard.usersAndAccess.email' | translate}}</th>
              <th class="left border-bottom-0">{{'blockchainSetupWizard.usersAndAccess.organization' | translate}}</th>
            </tr>
            </thead>
            <tbody>
            <tr>
              <td class="left">{{user.email}}</td>
              <td class="left">{{user.organization}}</td>
            </tr>
            </tbody>
          </table>
        </clr-dg-row-detail>
      </clr-dg-row>
    </clr-datagrid>

  </clr-wizard-page>

  <clr-wizard-page>
    <ng-template clrPageTitle>{{'blockchainSetupWizard.reviewDeployment.pageTitle' | translate}}</ng-template>
    <ng-template clrPageNavTitle>{{'blockchainSetupWizard.reviewDeployment.navTitle' | translate}}</ng-template>
    <p>{{'blockchainSetupWizard.reviewDeployment.description' | translate}}</p>

    <h4>
      {{'blockchainSetupWizard.reviewDeployment.chosenBlockchain' | translate}}
      <small class="text-muted ml-1">{{'blockchainSetupWizard.blockchainAndConsortium.' + form.value.blockchain.type | translate}}</small>
      <button type="button" class="btn btn-sm btn-link float-xs-right m-0" (click)="jumpTo(blockConsortiumPage)">{{'common.edit' | translate}}</button>
    </h4>

    <h4>
      {{'blockchainSetupWizard.reviewDeployment.consortiumSetup' | translate}}
      <small class="text-muted ml-1">{{form.value.consortium.name}}</small>
      <button type="button" class="btn btn-sm btn-link float-xs-right m-0" (click)="jumpTo(blockConsortiumPage)">{{'common.edit' | translate}}</button>
    </h4>
    <div formGroupName="advancedSettings" class="mt-1">
      <athena-accordion-group>
        <athena-accordion>
          <span class="title">{{'blockchainSetupWizard.reviewDeployment.advanced' | translate}}</span>
          <div class="accordion-body">
            <div class="form-block">
              <div class="form-group">
                <label>{{'blockchainSetupWizard.reviewDeployment.networkName' | translate}}</label>
                <input type="text" formControlName="networkName">
              </div>
              <div class="form-group">
                <label>{{'blockchainSetupWizard.reviewDeployment.numberOfNodes' | translate}}</label>
                <input type="number" formControlName="numberOfNodes">
              </div>
              <div class="form-group">
                <label>{{'blockchainSetupWizard.reviewDeployment.publicNodesRegions' | translate}}</label>
                <athena-combobox formControlName="publicNodesRegions"
                                 [items]="publicNodeItems"
                                 [position]="'top-left'"
                                 [multiSelect]="true"
                                 [showTooltip]="false"
                                 [isAddNewAllowed]="false"></athena-combobox>
              </div>
              <div class="form-group">
                <label>{{'blockchainSetupWizard.reviewDeployment.privateNode' | translate}}</label>
                <athena-combobox formControlName="privateNode"
                                 [items]="privateNodeItems"
                                 [position]="'top-left'"
                                 [multiSelect]="true"
                                 [showTooltip]="false"
                                 [isAddNewAllowed]="false"></athena-combobox>
              </div>
            </div>
          </div>
        </athena-accordion>
      </athena-accordion-group>
    </div>
    <h4>
      {{'blockchainSetupWizard.reviewDeployment.organizations' | translate}}
      <button type="button" class="btn btn-sm btn-link float-xs-right m-0" (click)="jumpTo(orgsPage)">{{'common.edit' | translate}}</button>
    </h4>
    <table class="table">
      <thead>
      <tr>
        <th class="left">{{'blockchainSetupWizard.addOrgs.name' | translate}}</th>
        <th class="left">{{'blockchainSetupWizard.addOrgs.location' | translate}}</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let org of form?.value.organizations">
        <td class="left">
          {{org.name}}
        </td>
        <td class="left">
          {{'blockchainSetupWizard.locations.' + org.location | translate}}
        </td>
      </tr>
      </tbody>
    </table>
    <h4>
      {{'blockchainSetupWizard.usersAndAccess.pageTitle' | translate}}
      <button type="button" class="btn btn-sm btn-link float-xs-right m-0" (click)="jumpTo(usersPage)">{{'common.edit' | translate}}</button>
      <clr-datagrid>
        <clr-dg-column>{{'blockchainSetupWizard.usersAndAccess.firstName' | translate}}</clr-dg-column>
        <clr-dg-column>{{'blockchainSetupWizard.usersAndAccess.lastName' | translate}}</clr-dg-column>
        <clr-dg-column>{{'blockchainSetupWizard.usersAndAccess.role' | translate}}</clr-dg-column>
        <clr-dg-row *ngFor="let user of form?.value.users">
          <clr-dg-cell>{{user.firstName}}</clr-dg-cell>
          <clr-dg-cell>{{user.lastName}}</clr-dg-cell>
          <clr-dg-cell>{{user.role}}</clr-dg-cell>
          <clr-dg-row-detail *clrIfExpanded>
            <table class="table table-noborder mt-0">
              <thead>
              <tr>
                <th class="left border-bottom-0">{{'blockchainSetupWizard.usersAndAccess.email' | translate}}</th>
                <th class="left border-bottom-0">{{'blockchainSetupWizard.usersAndAccess.organization' | translate}}</th>
              </tr>
              </thead>
              <tbody>
              <tr>
                <td class="left">{{user.email}}</td>
                <td class="left">{{user.organization}}</td>
              </tr>
              </tbody>
            </table>
          </clr-dg-row-detail>
        </clr-dg-row>
      </clr-datagrid>
    </h4>

  </clr-wizard-page>

</clr-wizard>
</form>
