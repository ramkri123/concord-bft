## Image to build dependencies
FROM ubuntu:16.04

RUN apt-get update && apt-get -y install \
    git \
    sudo

# Using Solidity 0.5.2 because it is the latest, and we need to pin
# to a release.  Reference:
# https://solidity.readthedocs.io/en/v0.5.2/installing-solidity.html

RUN git clone --recursive https://github.com/ethereum/solidity.git
WORKDIR /solidity
RUN git submodule update --init --recursive
RUN git checkout 1df8f40cd2fd7b47698d847907b8ca7b47eb488d
RUN ./scripts/install_deps.sh
RUN ./scripts/build.sh

## Drop source code and build time dependencies
FROM ubuntu:16.04
LABEL Description="Helen Prerequisites"

COPY --from=0 /usr/local/bin/solc /usr/local/bin/solc
COPY --from=0 /usr/lib/x86_64-linux-gnu/libz3.so.4 /usr/lib/x86_64-linux-gnu/
COPY --from=0 /usr/lib/x86_64-linux-gnu/libgomp.so.1 /usr/lib/x86_64-linux-gnu/
COPY --from=0 /usr/lib/x86_64-linux-gnu/libgomp.so.1.0.0 /usr/lib/x86_64-linux-gnu/
